---
title: "Specific leaf area in a coastal temperate deciduous forest: species and salinity effects"
author: "Lillie Haddock"
date: "8/13/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE} 
## Load necessary packages
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(ggrepel)
library(ggplot2)
```

## Motivation

Specific leaf area (SLA, the ratio of leaf area to leaf dry mass) is an important trait for plant physiological, structural, and modeling analyses. SLA is also a useful measurement to upscale plant production, vegetation community composition, and other processes in Earth System Models, providing current-day benchmarks and improving predictions of future vegetation structure and function in terrestrial ecosystems.

We investigate SLA differences between plots of varying elevation and salinity exposure along a tributary of the Chesapeake Bay. The goals of this project are to (i) quantify SLA of eight major tree species, at multiple canopy heights, in temperate deciduous forests at the Smithsonian Environmental Research Center (Maryland, USA); and (ii) test for effects of soil moisture and saltwater exposure on SLA by comparing samples taken at shoreline and upland positions, with the shoreline samples taken along a ~2 km tidal creek that provided a natural salinity gradient.

Map of SERC with plots labeled: 


## Sampling Design

I think this would be a good place for methods

![Figure 1: Collecting samples using a pole pruner](../Photos/polepruner.png)

![Figure 2: Collecting samples using a hand pruner](../Photos/sampling1.png)

![Figure 3: All the samples after a morning of collecting](../Photos/sampling2.png)


(I will evenually figure out how to only show the four species we are sampling from :) )


```{r, include=FALSE}
samp_char <- read_csv("../Design/sampling_characteristics.csv")
```
```{r, echo = FALSE}
knitr::kable(samp_char, caption = "Characteristics of Species Sampled")
```

### SLA Calculation
```{r, include=FALSE}
sla <- read.csv("../SLA Data.csv", stringsAsFactors = FALSE) %>% 
  mutate(Tag = as.character(Tag))
print(sla)
print(summary(sla))
```

SLA is calculated using the ratio between a leaf's one-sided fresh leaf area and its total dry mass. 

```{r}
sla <- sla %>% 
  mutate(specific_leaf_area = round(Leaf_Area_cm2 / Leaf_Mass_g, 3)) 
```
```{r, echo = FALSE}
summary(sla)
```


```{r, echo = FALSE}
## Join with inventory data

## Read in the storm surge inventory data
ss_inventory <- read.csv("../ss-inventory.csv", stringsAsFactors = FALSE) %>% 
  select(Plot, Species_code, Tag, DBH) %>% 
  mutate(Tag = as.character(Tag))
summary(ss_inventory)

## The 'shore' plot at GCREW overlaps with the PREMIS-ghg HSLE plot,
## so use that transplant inventory data too
inventory <- read.csv("../inventory.csv", stringsAsFactors = FALSE) %>% 
  select(Plot, Tag, Species_code, DBH = DBH_cm_2019) %>% 
  filter(Plot == "HSLE") %>%  # GCREW only
  mutate(Plot = "Shore") %>% 
  bind_rows(ss_inventory)

# Create new dataset with plot, species, and tag columns
# by joining with the storm surge inventory data
sla %>% 
  left_join(inventory, by = "Tag") %>% 
  # if NA DBH, then get information from what we measured in field
  mutate(DBH = if_else(is.na(DBH), No_Tag_DBH, DBH),
         Species_code = if_else(is.na(Species_code), No_Tag_Species_code, Species_code),
         Plot = if_else(is.na(Plot), No_Tag_Plot, Plot)) %>% 
  # We only want four letter species codes
  mutate(Species_code = substr(Species_code, 1,4)) ->
  sla_joined

# At this point there should be NO data with an NA for Plot or DBH or Species_code
# Warn if this occurs
if(any(is.na(sla_joined$DBH))) {
  warning("We still have unmatched trees!")  
}
if(any(sla_joined$Species_code == "")) {
  warning("We have blank species codes!")  
}
```

### Average Specific Leaf Area
```{r, echo = FALSE}
## SLA by species box plot
sla_with_tag <- sla_joined %>%
  ggplot(aes(Species_code, specific_leaf_area, label = Tag, color = Position)) +
  geom_boxplot() +
  geom_text_repel() +
  geom_point() + 
  labs(title = "Specific Leaf Area by Species and Tag Number", y = "Specific Leaf Area")
print(sla_with_tag)
```

### Specific Leaf Area by Species
```{r, echo = FALSE}
## SLA faceted by species
sla_by_species <- sla_joined %>%
  ggplot(aes(Plot, specific_leaf_area, color = Position)) +
  geom_point() + 
  geom_jitter() +
  facet_wrap(~Species_code) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Specific Leaf Area by Species and Plot", y = "Specific Leaf Area")
print(sla_by_species)
```


Hmmm.... not sure where the top left species code went :/

### The Relationship Between Specific Leaf Area and Tree Diameter at Breast Height
```{r, echo = FALSE}
## DBH vs sla colored by species
sla_vs_dbh <- sla_joined %>% 
  ggplot(aes(DBH, specific_leaf_area, color = Species_code)) +
  geom_point() + 
  facet_wrap(~Species_code) +
  geom_smooth(method = "lm") +
  labs(title = "Specific Leaf Area vs. DBH", y = "Specific Leaf Area")
print(sla_vs_dbh)
```



### 
## 